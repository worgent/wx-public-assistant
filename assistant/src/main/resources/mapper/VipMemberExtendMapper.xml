<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="weixin.assistant.dao.VipMemberExtendMapper">

    <update id="incMoneyInputByExample" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update vip_member
        set
        money_input = money_input+ #{fee,jdbcType=INTEGER}
        where id = #{id,jdbcType=INTEGER}
    </update>

    <update id="incMoneyOutputByExample" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update vip_member
        set
        money_output = money_output+ #{fee,jdbcType=INTEGER}
        where id = #{id,jdbcType=INTEGER}
    </update>

    <select id="queryForList" parameterType="map" resultType="java.util.Map">

        select m.id as vipCardNumMapKey,m.name as vipNameMapKey,m.tel as phoneMapKey,m.create_time as createTimeMapKey,m.status as statusMapKey,(m.money_input-m.money_output) as feeMapKey,b.name as mendianMapKey,
        r.finish_time as czTimeMapKey,r.fee as czMoneyMapKey,p.coupons_type,p.finish_time as xfTimeMapKey,p.fee as xfMoneyMapKey,p.pay_type
        from vip_business b,vip_member m,vip_pay_order p,vip_recharge_order r
        where
        1 = 1
        <if test="czMoneyMin != null">
            and r.fee BETWEEN #{czMoneyMin} and #{czMoneyMax}
        </if>
        <if test="xfMoneyMin != null">
            and p.fee BETWEEN #{xfMoneyMin} and #{xfMoneyMax}
        </if>
        <if test="vipName != null">
            and m.name like "%"#{vipName}"%"
        </if>
        <if test="mendian != null">
            and b.name=#{mendian}
        </if>
        <if test="czFinishTime != null">
            and r.finish_time like "%"#{czFinishTime}"%" and r.status=#{status}
        </if>
        <if test="xfFinishTime != null">
            and p.finish_time like "%"#{xfFinishTime}"%" and p.status=#{status}
        </if>
        <if test="tel != null">
            and m.tel=#{tel}
        </if>
        <if test="payType != null">
            and p.pay_type=#{payType}
        </if>
        <if test="searchType == 1">
            and m.id like "%"#{searchName}"%"
        </if>
        <if test="searchType == 2">
            and m.name like "%"#{searchName}"%"
        </if>
        <if test="searchType == 3">
            and m.tel like "%"#{searchName}"%"
        </if>
        limit #{start},#{pageSize}
    </select>
    <select id="totalCount" parameterType="map" resultType="int">

        select count(*) from vip_business b,vip_member m,vip_pay_order p,vip_recharge_order r
        where
        1 = 1
        <if test="czMoneyMin != null">
            and r.fee BETWEEN #{czMoneyMin} and #{czMoneyMax}
        </if>
        <if test="xfMoneyMin != null">
            and p.fee BETWEEN #{xfMoneyMin} and #{xfMoneyMax}
        </if>
        <if test="vipName != null">
            and m.name like "%"#{vipName}"%"
        </if>
        <if test="mendian != null">
            and b.name=#{mendian}
        </if>
        <if test="czFinishTime != null">
            and r.finish_time like "%"#{czFinishTime}"%" and r.status=#{status}
        </if>
        <if test="xfFinishTime != null">
            and p.finish_time like "%"#{xfFinishTime}"%" and p.status=#{status}
        </if>
        <if test="tel != null">
            and m.tel=#{tel}
        </if>
        <if test="payType != null">
            and p.pay_type=#{payType}
        </if>
        <if test="searchType == 1">
            and m.id like "%"#{searchName}"%"
        </if>
        <if test="searchType == 2">
            and m.name like "%"#{searchName}"%"
        </if>
        <if test="searchType == 3">
            and m.tel like "%"#{searchName}"%"
        </if>
    </select>
    <select id="vipTotalCount" parameterType="map" resultType="int">

        select count(*) from vip_member m
        where
        1 = 1

        <if test="searchType == 1">
            and m.id like "%"#{searchName}"%"
        </if>
        <if test="searchType == 2">
            and m.name like "%"#{searchName}"%"
        </if>
        <if test="searchType == 3">
            and m.tel like "%"#{searchName}"%"
        </if>
        <if test="createTime != null">
            and m.create_time like "%"#{createTime}"%"
        </if>
    </select>
    <select id="vipQueryForList" parameterType="map" resultType="java.util.Map">

        select m.id as vipCardNumMapKey,m.name as vipNameMapKey,m.tel as phoneMapKey,m.create_time as createTimeMapKey,m.status as statusMapKey,(m.money_input-m.money_output) as feeMapKey
        from vip_member m
        where
        1 = 1

        <if test="searchType == 1">
            and m.id like "%"#{searchName}"%"
        </if>
        <if test="searchType == 2">
            and m.name like "%"#{searchName}"%"
        </if>
        <if test="searchType == 3">
            and m.tel like "%"#{searchName}"%"
        </if>
        limit #{start},#{pageSize}
    </select>
</mapper>